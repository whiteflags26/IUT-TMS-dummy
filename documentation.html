<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requisition System API Documentation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
        }
        h1, h2, h3 {
            color: #333;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .endpoint {
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Requisition System API Documentation</h1>

    <h2>Authentication API</h2>

    <h3>1. Register a New User</h3>
    <div class="endpoint">Endpoint: POST /api/auth/register</div>
    <div>Description: Registers a new user in the system.</div>
    <h4>Request Body:</h4>
    <pre>
{
    "username": "string",
    "email": "string",
    "password": "string",
    "role": "string",  // Roles can be 'ADMIN', 'FACULTY', 'HOD', 'CHAIRMAN', 'VC'
    "department": "string"
}
    </pre>
    <h4>Role Descriptions:</h4>
    <ul>
        <li><strong>ADMIN:</strong> Has full access to manage users and requisitions.</li>
        <li><strong>FACULTY:</strong> Can create and view requisitions.</li>
        <li><strong>HOD:</strong> Can approve requisitions created by faculty members.</li>
        <li><strong>CHAIRMAN:</strong> Can approve or reject requisitions.</li>
        <li><strong>VC:</strong> Has the highest level of authority to approve requisitions.</li>
    </ul>
    <h4>Example Request:</h4>
    <pre>
curl -X POST http://localhost:3000/api/auth/register \
-H "Content-Type: application/json" \
-d '{
    "username": "adminuser",
    "email": "admin@iut.ac.bd",
    "password": "admin123",
    "role": "ADMIN",
    "department": "ADMIN"
}'
    </pre>
    <h4>Successful Response:</h4>
    <pre>
{
    "status": "success",
    "data": {
        "user": {
            "id": 1,
            "username": "adminuser",
            "email": "admin@iut.ac.bd",
            "role": "ADMIN",
            "department": "ADMIN"
        },
        "token": "eyJhbGciOiJIUzI1NiIs..."
    }
}
    </pre>
    <h4>Error Response:</h4>
    <pre>
{
    "status": "error",
    "message": "User already exists"
}
    </pre>

    <h3>2. Login User</h3>
    <div class="endpoint">Endpoint: POST /api/auth/login</div>
    <div>Description: Authenticates a user and returns a JWT token.</div>
    <h4>Request Body:</h4>
    <pre>
{
    "email": "string",
    "password": "string"
}
    </pre>
    <h4>Example Request:</h4>
    <pre>
curl -X POST http://localhost:3000/api/auth/login \
-H "Content-Type: application/json" \
-d '{
    "email": "admin@iut.ac.bd",
    "password": "admin123"
}'
    </pre>
    <h4>Successful Response:</h4>
    <pre>
{
    "status": "success",
    "data": {
        "user": {
            "id": 1,
            "username": "adminuser",
            "email": "admin@iut.ac.bd",
            "role": "ADMIN",
            "department": "ADMIN"
        },
        "token": "eyJhbGciOiJIUzI1NiIs..."
    }
}
    </pre>
    <h4>Error Response:</h4>
    <pre>
{
    "status": "error",
    "message": "Invalid email or password"
}
    </pre>

    <h2>Requisition API</h2>

    <h3>1. Create a New Requisition</h3>
    <div class="endpoint">Endpoint: POST /api/requisitions</div>
    <div>Description: Creates a new requisition.</div>
    <div>Roles Allowed: FACULTY, HOD, CHAIRMAN, VC</div>
    <h4>Request Body:</h4>
    <pre>
{
    "userId": "number",
    "purpose": "string",
    "destination": "string",
    "dateRequired": "date",
    "returnDate": "date",
    "numberOfPassengers": "number",
    "contactNumber": "string"
}
    </pre>
    <h4>Example Request:</h4>
    <pre>
curl -X POST http://localhost:3000/api/requisitions \
-H "Authorization: Bearer &lt;token&gt;" \
-H "Content-Type: application/json" \
-d '{
    "userId": 2,
    "purpose": "Field Trip to Science Museum",
    "destination": "Downtown Science Museum",
    "dateRequired": "2024-11-10T10:00:00Z",
    "returnDate": "2024-11-10T15:00:00Z",
    "numberOfPassengers": 25,
    "contactNumber": "123-456-7890"
}'
    </pre>
    <h4>Successful Response:</h4>
    <pre>
{
    "status": "success",
    "data": {
        "id": 1,
        "userId": 2,
        "purpose": "Field Trip to Science Museum",
        "destination": "Downtown Science Museum",
        "dateRequired": "2024-11-10T10:00:00Z",
        "returnDate": "2024-11-10T15:00:00Z",
        "numberOfPassengers": 25,
        "contactNumber": "123-456-7890",
        "status": "PENDING"
    }
}
    </pre>

    <h3>2. Get a Specific Requisition</h3>
    <div class="endpoint">Endpoint: GET /api/requisitions/{id}</div>
    <div>Description: Retrieves a specific requisition by its ID.</div>
    <div>Roles Allowed: FACULTY, HOD, CHAIRMAN, VC, ADMIN</div>
    <h4>Example Request:</h4>
    <pre>
curl -X GET http://localhost:3000/api/requisitions/1 \
-H "Authorization: Bearer &lt;token&gt;"
    </pre>
    <h4>Successful Response:</h4>
    <pre>
{
    "status": "success",
    "data": {
        "id": 1,
        "userId": 2,
        "purpose": "Field Trip to Science Museum",
        "status": "PENDING"
    }
}
    </pre>

    <h3>3. Update a Requisition</h3>
    <div class="endpoint">Endpoint: PUT /api/requisitions/{id}</div>
    <div>Description: Updates an existing requisition.</div>
    <div>Roles Allowed: FACULTY, HOD, CHAIRMAN, VC, ADMIN</div>
    <h4>Request Body:</h4>
    <pre>
{
    "purpose": "string",
    "destination": "string",
    "dateRequired": "date",
    "returnDate": "date",
    "numberOfPassengers": "number",
    "contactNumber": "string",
    "status": "string", // Can be 'PENDING', 'HOD_APPROVED', 'CHAIRMAN_APPROVED', 'VC_APPROVED', 'REJECTED', 'COMPLETED'
    "vehicleId": "number",
    "driverId": "number",
    "notes": "string",
    "rejectionReason": "string"
}
    </pre>
    <h4>Example Request:</h4>
    <pre>
curl -X PUT http://localhost:3000/api/requisitions/1 \
-H "Authorization: Bearer &lt;token&gt;" \
-H "Content-Type: application/json" \
-d '{
    "status": "APPROVED",
    "notes": "Approved by the Head of Department."
}'
    </pre>
    <h4>Successful Response:</h4>
    <pre>
{
    "status": "success",
    "data": {
        "id": 1,
        "status": "APPROVED",
        "notes": "Approved by the Head of Department."
    }
}
    </pre>

    <h3>4. Delete a Requisition</h3>
    <div class="endpoint">Endpoint: DELETE /api/requisitions/{id}</div>
    <div>Description: Deletes a requisition by its ID.</div>
    <div>Roles Allowed: CHAIRMAN, ADMIN</div>
    <h4>Example Request:</h4>
    <pre>
curl -X DELETE http://localhost:3000/api/requisitions/4 \
-H "Authorization: Bearer &lt;token&gt;"
    </pre>
    <h4>Successful Response:</h4>
    <pre>
{
    "message": "Requisition deleted"
}
    </pre>

   <h3>5. Search Requisitions</h3>
<div class="endpoint">Endpoint: GET /api/requisitions/search</div>
<div>Description: Searches requisitions based on various query parameters.</div>
<h4>Query Parameters:</h4>
<ul>
    <li><strong>purpose</strong> (string, optional): Filter requisitions by purpose.</li>
    <li><strong>destination</strong> (string, optional): Filter requisitions by destination.</li>
    <li><strong>status</strong> (string, optional): Filter by status (e.g., 'PENDING', 'APPROVED').</li>
    <li><strong>from</strong> (date, optional): Filter requisitions starting from this date.</li>
    <li><strong>to</strong> (date, optional): Filter requisitions up to this date.</li>
    <li><strong>userId</strong> (number, optional): Filter requisitions by user ID.</li>
    <li><strong>numberOfPassengers</strong> (range, optional): Filter requisitions by a range of the number of passengers (e.g., `1,5` to filter between 1 and 5).</li>
    <li><strong>sort</strong> (array, optional): Specify fields to sort by, along with the order (`asc` or `desc`). Use exact column names from the database:
        <ul>
            <li><strong>purpose</strong> (`purpose`): Sort by the purpose of the requisition.</li>
            <li><strong>destination</strong> (`destination`): Sort by the destination of the requisition.</li>
            <li><strong>dateRequired</strong> (`date_required`): Sort by the date the requisition is required.</li>
            <li><strong>createdAt</strong> (`created_at`): Sort by the creation date of the requisition.</li>
            <li><strong>numberOfPassengers</strong> (`number_of_passengers`): Sort by the number of passengers requested.</li>
            <li><strong>status</strong> (`status`): Sort by the status of the requisition.</li>
            <li><strong>hodApprovalDate</strong> (`hod_approval_date`): Sort by the date of HOD approval.</li>
            <li><strong>chairmanApprovalDate</strong> (`chairman_approval_date`): Sort by the date of chairman approval.</li>
            <li><strong>vcApprovalDate</strong> (`vc_approval_date`): Sort by the date of VC approval.</li>
            <li><strong>updatedAt</strong> (`updated_at`): Sort by the last updated date.</li>
        </ul>
    </li>
    <li><strong>page</strong> (number, optional): Page number for pagination (default: 1).</li>
    <li><strong>limit</strong> (number, optional): Number of items per page (default: 10).</li>
</ul>

<h4>Example Request (Simple Search with Sorting):</h4>
<pre>
curl -X GET "http://localhost:3000/api/requisitions/search?purpose=Field%20Trip" \
-H "Authorization: Bearer &lt;token&gt;"
</pre>

<h4>Example Request (Complex Search with Sorting and Number Range):</h4>
<pre>
curl -X GET "http://localhost:3000/api/requisitions/search?destination=Downtown%20Science%20Museum&status=PENDING&from=2024-11-01&to=2024-11-10&numberOfPassengers=1,5&sort=date_required,asc&sort=number_of_passengers,desc&page=2&limit=5" \
-H "Authorization: Bearer &lt;token&gt;"
</pre>

<h4>Successful Response:</h4>
<pre>
{
    "status": "success",
    "data": {
        "results": [
            {
                "id": 1,
                "userId": 2,
                "purpose": "Field Trip to Science Museum",
                "destination": "Downtown Science Museum",
                "status": "PENDING",
                "dateRequired": "2024-11-10T10:00:00Z",
                "numberOfPassengers": 25
            },
            {
                "id": 2,
                "userId": 3,
                "purpose": "Workshop at Art Gallery",
                "destination": "Art Gallery",
                "status": "PENDING",
                "dateRequired": "2024-11-05T09:00:00Z",
                "numberOfPassengers": 15
            }
        ],
        "pagination": {
            "currentPage": 2,
            "totalPages": 10,
            "totalResults": 50
        }
    }
}
</pre>

<h4>Error Response:</h4>
<pre>
{
    "status": "error",
    "message": "No requisitions found"
}
</pre>

</body>
</html>

